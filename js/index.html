<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>班级管理</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/indexM.css"/>
    <link rel="stylesheet" href="css/all.css"/>
    <link rel="stylesheet" href="css/xuxkpopWindow.css"/>
    <link rel="stylesheet" href="css/page.css"/>
    <link rel="stylesheet" href="css/xuxk.css"/>
    <link rel="stylesheet" href="css/gobal.css"/>
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/addTmpImg.js"></script>
    <script src="js/public.js"></script>
    <!--<link rel="stylesheet" href="css/default.css"/>-->
    <!--<link rel="stylesheet" href="css/css/default.css"/>-->
    <script src="js/xuxkBrief.js"></script>
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        body {
            font-size: 12px;
            font-family: Arial, Helvetica, sans-serif, 宋体;
            color: rgb(51, 51, 51);
            background: #d0e89b;
        }
        .level2 span:nth-child(2) {
            width: 70px;
        }
        .boxRtBoxBottom,.boxRtBox,.boxRt,.box_in {
            height: auto !important;
        }
        .boxRt{
            padding-bottom: 20px !important;
        }
        /*body {font: normal 100% Helvetica, Arial,sans-serif;}*/
    </style>
    <script>
        var token = localStorage.getItem('token');
        var classId = '';
        //        var windowSize=function () {
        //            var winWidth,winHeight;
        //            //获取窗口宽度
        //            if (window.innerWidth)
        //                winWidth = window.innerWidth;
        //            else if ((document.body) && (document.body.clientWidth))
        //                winWidth = document.body.clientWidth;
        //            //获取窗口高度
        //            if (window.innerHeight)
        //                winHeight = window.innerHeight;
        //            else if ((document.body) && (document.body.clientHeight))
        //                winHeight = document.body.clientHeight;
        //            //通过深入Document内部对body进行检测，获取窗口大小
        //            if (document.documentElement && document.documentElement.clientHeight &&document.documentElement.clientWidth)
        //            {
        //                winHeight = document.documentElement.clientHeight;
        //                winWidth = document.documentElement.clientWidth;
        //            }
        //            //返回对象结果
        //            return {'width':winWidth,'w':winWidth,'height':winHeight,'h':winHeight};
        //        }
        //
        //        //上述代码通过windowSize方法返回当前浏览器一屏窗口的宽度与高度【注意此处一屏的概念】
        //
        //        $(document).ready(function ()  {
        //            var PageStyle= function () {
        //                var SysWidht = windowSize().width,wrap=$('.wrap');//此处也可以使用jquery的$(window).width()获取页面宽度
        //                if(SysWidht<1200) {
        //                    wrap.removeClass('wrapBig').addClass('wrapSmall');
        //                }else {
        //                    wrap.removeClass('wrapSmall').addClass('wrapBig');
        //                }
        //            };
        //            /*init*/
        //            PageStyle();
        //            /*event*/
        //            $(window).resize(function () {
        //                PageStyle();
        //            });
        //        });
    </script>


</head>
<body>
<div class="mantain">
    <!--顶部导航-->
    <div class="zoneBg">
        <div class="topLine">
            <div class="topLineBelore">
                <div class="logo lf">
                    <a href="js_index.html">
                        <img style="    vertical-align: middle" src="images/logoTop.png" alt=""/>
                    </a>
                </div>
                <div class="exit rt">
                    <span></span>
                    <a href="javascript:;" onclick="getoutjs(token)">退出</a>

                </div>
            </div>
        </div>
        <div class="bg1">
            <img src="images/touming.png" alt=""/>
        </div>
        <!--正文内容-->
        <div class="box">
            <div class="box_in">
                <div class="boxLf lf course">
                    <ul>
                        <li class="level1">
                            <div class="level1Style">
                                <div class="level1Styleline first">
                                    <span class="icon1"></span>
                                    <span>我的班级</span>
                                </div>
                            </div>
                            <div class="menuLevel2">
                                <ul>
                                    <!--<li class="level2 btnone" style="background: #b1c54c;color: #fff"><span-->
                                    <!--style="background:url(images/icon44.png) "></span><span>-->
                                    <!--养老001</span></li>-->
                                    <!--<li class="level2"><span></span><span>-->
                                    <!--养老002</span></li>-->

                                </ul>
                                <div  style="height: 40px;">
                                    <span class="addClassIcon" style="    background: url(images/addClass.png);display: inline-block;width: 10px;height: 10px;vertical-align: top;line-height: 40px !important;margin-left: 38px;margin-top: 15px;"></span>
                                    <span  class="addClass" style="display: inline-block;line-height: 40px;font-size: 14px;margin-left:8px;vertical-align: top;">新增班级</span>
                                </div>
                            </div>
                        </li>
                    </ul>


                </div>
                <div class="boxRt lf">
                    <div class="boxRtBox">
                        <div class="boxRtBoxTop">
                            <div class="classroom">
                                <span></span>
                                <span>三年二班</span>
                            </div>
                            <div class="classroomRt"></div>
                        </div>
                        <div class="classedit">
                            <span class="modifyClass">修改班级</span>
                            <span class="addStudent">新增学生</span>
                            <span class="linkStudent">导入学生</span>

                            <form id="uoloadxslx" action style="display: none">
                                <input type="file" name="file" id="file" class="file"  accept=".xls,.xlsx"/>
                            </form>
                            <span class="saveClass">班级归档</span>
                            <span class="deleteClass">删除班级</span></div>
                        <div class="boxRtBoxBottom">
                            <!--<iframe ID="Frame4" SRC="login.html" STYLE="background-color: green"> </iframe>-->
                            <!--学习项目-->
                            <table class="table indextable" cellpadding="0" cellspacing="0">
                                <thead>
                                <tr>
                                    <th>学号</th>
                                    <th>姓名</th>
                                    <th>密码</th>
                                    <th>任务</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                            <div class="paging">
                                <div class="rt">
                                    <span class="lastpage"><span></span>&nbsp;上一页</span>&nbsp;&nbsp;
                                    <span class="nextpage">下一页&nbsp;<span></span></span>&nbsp;&nbsp;&nbsp;
                                    到第 &nbsp; &nbsp;<input type="text" value=""/>&nbsp;&nbsp;
                                    页&nbsp;&nbsp;
                                    <button class="makeSure">确定</button>
                                    &nbsp;&nbsp;</div>

                            </div>
                        </div>


                    </div>
                </div>
                <!--书页线-->
                <div class="boxRtBottom rt"></div>
            </div>
            <div class="clear"></div>
            <div class="footer" style="background: #d0e89b">
                <div class="information" style="padding: 0;margin: 0">             <ul  style="padding: 0;margin: 0">                 <li><img src="../images/bottomText.png" alt="" style="width: 460px"/></li>             </ul>         </div>

            </div>
        </div>
    </div>
</div>

<!--<div class="popopowindow">-->
<!--<div class="popBackground"></div>-->
<!--<div class="popAddMoneyBox">-->
<!--<div class="popAddMoneyTop">-->
<!--<span class="lf">新增班级</span> <span class="deleteIcon rt" onclick="delThis()"></span>-->
<!--</div>-->
<!--<div class="popAddMoneyBottom">-->
<!--<div style="margin: 150px auto 130px">-->
<!--<span>班级名称</span><input value="" class="inputbox1" type="text" maxlength="30"/>-->
<!--</div>-->
<!--<button onclick="savegzls2()" id="'+this_id+'" class="popAddMoneyBoxBtn">保存</button>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->
<!--<div class="popopowindow">-->
<!--<div class="popBackground"></div>-->
<!--<div class="popAddMoneyBox">-->
<!--<div class="popAddMoneyTop">-->
<!--<span class="lf">新增班级</span> <span class="deleteIcon rt" onclick="delThis()"></span>-->
<!--</div>-->
<!--<div class="popAddMoneyBottom">-->
<!--<div style="margin: 100px auto 10px">-->
<!--<span>学号</span><input value="" class="inputbox1" type="text" maxlength="30"/>-->
<!--</div>-->
<!--<div style="margin: 0 auto 10px">-->
<!--<span>姓名</span><input value="" class="inputbox1" type="text" maxlength="30"/>-->
<!--</div>-->
<!--<div style="margin: 0 auto 86px">-->
<!--<span>密码</span><input value="" class="inputbox1" type="text" maxlength="30"/>-->
<!--</div>-->
<!--<button onclick="savegzls2()" id="'+this_id+'" class="popAddMoneyBoxBtn">保存</button>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->

<!--<div class="popopowindow">-->
<!--<div class="popBackground"></div>-->
<!--<div class="popAddMoneyMinBox">-->
<!--<div class="popAddMoneyTop">-->
<!--<span class="lf">请输入密码</span> <span class="deleteIcon rt" onclick="delThis()"></span>-->
<!--</div>-->
<!--<div class="popAddMoneyMinBottom">-->
<!--<div style="margin: 100px auto 10px">-->
<!--<span>确认归档后，该班级信息将不再此位置展示，是否归档！</span>-->
<!--</div>-->
<!--<div class="minBtn">-->
<!--<button class="refusemin rt">取消</button>-->
<!--<button class="makeSuremin rt">确认</button>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->


<script type="text/javascript">
    var xm_type = GetQueryString('xm_type');
function reloadwidth(){
    var lfWidth=$('.classroom').width()
    console.log(lfWidth)
    var classroomRtWidth=879-lfWidth-20.5
    console.log(classroomRtWidth)
    $(".classroomRt").css('width',classroomRtWidth+'px')
}



    //    var popscrollwidth = $(window).width();
    //    var popscrollheight = $(window).height();
    //    console.log(popscrollwidth, popscrollheight);
    //    $(".popAddMoneyMinBox").css('left', (popscrollwidth / 2 - 180) + "px").css('top', (popscrollheight / 2 - 96.5) + "px");

    $('.boxLf').on('click', '.level1 .level1Style', function () {
//    $('.level1 .level1Style').click(function () {
//        $(this).children('.menuLevel2').slideToggle();
        $(this).siblings().slideToggle();
        console.log($(this).parent().siblings());
        $(this).parent().siblings().children('.menuLevel2').slideUp();
        $(this).parent().siblings().find('.level2 span:nth-child(1)').css('background', 'url(images/icon4.png)');
        $(this).parent().siblings().find('.level2').css('background', '#fff ').css('color', '#585631')
    });
    var pageNo=1
    $('.level1').on('click', '.menuLevel2 .level2', function () {

//    $('.level1 .level2').click(function () {
        classroomName = $(this).children().eq(1).html();
        $('.classroom span:nth-child(2)').html(classroomName);
        reloadwidth()
        classId = $(this).attr('id');
        $(this).children('span:nth-child(1)').css('background', 'url(images/icon44.png)');
        $(this).css('background', '#b1c54c').css('color', '#fff');
        $(this).siblings().children('span:nth-child(1)').css('background', 'url(images/icon4.png)');
        $(this).siblings().css('background', '#fff ').css('color', '#585631');


        $.ajax({
            url: "/cszyylfw/js/xsgl/studentlist",
            type: 'post',
            async: false,
            data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
            success: function (res) {
                if (res.code == 0) {
                    $('.indextable tbody').html('');
                    for (var i = 0; i < res.data.items.length; i++) {


                        $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                    }
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！')
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })


    })

    function studentList(){
        $.ajax({
            url: "/cszyylfw/js/xsgl/studentlist",
            type: 'post',
            async: false,
            data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
            success: function (res) {
                if (res.code == 0) {
                    if (res.data.items.length == 0) {
//                        $('.indextable tbody').html('');
                        if(pageNo==1){ $('.indextable tbody').html(''); return}
                        error('没有更多数据！');
                        pageNo--;
                        return
                    }
                    $('.indextable tbody').html('');
                    for (var i = 0; i < res.data.items.length; i++) {
                        $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                    }
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！');
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })
    }
    $('.btnone').click(function () {
        console.log(1)
        $('.boxRtBoxBottom table:nth-child(1)').css('display', '');
        $('.boxRtBoxBottom table:nth-child(1)').siblings().css('display', 'none')
    })
    $('.btntwo').click(function () {
        console.log(2)
        $('.boxRtBoxBottom table:nth-child(2)').css('display', '');
        $('.boxRtBoxBottom table:nth-child(2)').siblings().css('display', 'none')
    })
    $('.btnthree').click(function () {
        console.log(3)
        $('.boxRtBoxBottom table:nth-child(3)').css('display', '');
        $('.boxRtBoxBottom table:nth-child(3)').siblings().css('display', 'none')
    })
    $('.btnfour').click(function () {
        $('.boxRtBoxBottom table:nth-child(4)').css('display', '');
        $('.boxRtBoxBottom table:nth-child(4)').siblings().css('display', 'none')
    })
    loginrefresh(token)
    $.ajax({
        url: "/cszyylfw/js/xsgl/clazzlist",
        type: 'post',
        async: false,
        data: 'token=' + token + '&page_no=1&page_size=100',
        success: function (res) {
            if (res.code == 0) {
                $('.menuLevel2 ul').html('');

                for (var i = 0; i < res.data.items.length; i++) {
                    if (i == 0) {
                        $('.classroom span:nth-child(2)').html(res.data.items[0].name)
                        classId = res.data.items[0].id;
                        $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                    } else {
                        $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                    }
                }


                if (res.data.items.length > 0) {
                    classId = res.data.items[0].id;
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/studentlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
                        success: function (res) {
                            if (res.code == 0) {
                                if (res.code == 0) {
                                    $('.indextable tbody').html('');
                                    for (var i = 0; i < res.data.items.length; i++) {
                                        $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                                    }
                                } else if (res.code == 20) {
                                    alert('登陆超时，请重新登录！')
                                    setTimeout(function () {
                                        location.href = 'js_index.html'
                                    }, 1000)

                                } else {
                                    alert(res.codeMsg)
                                }
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！')
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                }
            } else if (res.code == 20) {
                alert('登陆超时，请重新登录！');
                setTimeout(function () {
                    location.href = 'js_index.html'
                }, 1000)

            } else {
                alert(res.codeMsg)
            }
        }
    })

    $('.lastpage').click(function () {


        pageNo--;
        if (pageNo > 0) {
            studentList()
        } else {
            error('已到达第一页！');
            pageNo++
        }

    })
    $('.nextpage').click(function () {
//        if (!$('.yourselect span').attr('type')) {
//            type = ''
//        } else {
//            type = $('.yourselect span').attr('type')
//        }
        pageNo++;
        studentList()
    })

</script>
<!--顶部按钮操作-->
<script>
    //    新增班级
    $('.addClass').click(function () {
        $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyBox"> <div class="popAddMoneyTop"> <span class="lf">新增班级</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyBottom"> <div style="margin: 150px auto 130px"> <span>班级名称</span><input value="" class="inputbox1" type="text" maxlength="30"/> </div> <button onclick="addClass()"  class="popAddMoneyBoxBtn">保存</button> </div> </div> </div>')
        var popscrollwidth = $(window).width();
        var popscrollheight = $(window).height();
        console.log(popscrollwidth, popscrollheight);
        $(".popAddMoneyBox").css('left', (popscrollwidth / 2 - 335) + "px").css('top', (popscrollheight / 2 - 220) + "px");
    })
    function addClass() {
        var name = $('.inputbox1').val()

        $.ajax({
            url: "/cszyylfw/js/xsgl/addclazz",
            type: 'post',
            async: false,
            data: 'token=' + token + "&name=" + name,
            success: function (res) {
                if (res.code == 0) {
                    $('.popopowindow').remove()
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/clazzlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + '&page_no=1&page_size=100',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.menuLevel2 ul').html('');

                                for (var i = 0; i < res.data.items.length; i++) {
                                    if (i == 0) {
                                        $('.classroom span:nth-child(2)').html(res.data.items[i].name)
                                        reloadwidth()
                                        classId = res.data.items[0].id;
                                        $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                                    } else {
                                        $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                                    }
                                }
                                studentList()
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！')
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！')
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })
    }
    //    新增学生
    $('.addStudent').click(function () {
        if (classId == '' || classId == 'undefined' || classId == 'null' || classId == undefined || classId == null) {
            error('请先添加/选择班级')
        } else {
            $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyBox"> <div class="popAddMoneyTop"> <span class="lf">新增学生</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyBottom"> <div style="margin: 100px auto 10px"> <span>学号</span><input value="" class="studentNum" type="text" maxlength="30"/> </div> <div style="margin: 0 auto 10px"> <span>姓名</span><input value="" class="studentName" type="text" maxlength="30"/> </div> <div style="margin: 0 auto 86px"> <span>密码</span><input value="" class="studentPwd" type="text" maxlength="30"/> </div> <button onclick="addStudent()"  class="popAddMoneyBoxBtn">保存</button> </div> </div> </div>')
            var popscrollwidth = $(window).width();
            var popscrollheight = $(window).height();
            console.log(popscrollwidth, popscrollheight);
            $(".popAddMoneyBox").css('left', (popscrollwidth / 2 - 335) + "px").css('top', (popscrollheight / 2 - 220) + "px");
        }
    });
    function addStudent() {
        var realname = $('.studentName').val();
        var student_no = $('.studentNum').val();
        var pwd = $('.studentPwd').val();
        var clazz_id = classId;
        $.ajax({
            url: "/cszyylfw/js/xsgl/addstudent",
            type: 'post',
            async: false,
            data: 'token=' + token + "&realname=" + realname + "&student_no=" + student_no + "&pwd=" + pwd + "&clazz_id=" + clazz_id,
            success: function (res) {
                if (res.code == 0) {
                    $('.popopowindow').remove()
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/studentlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + "&clazz_id=" + clazz_id + '&page_no='+pageNo+'&page_size=50',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.indextable tbody').html('');
                                for (var i = 0; i < res.data.items.length; i++) {
                                    $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                                }
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！');
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！');
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })
    }
    //    删除班级
    $('.boxRtBox').on('click', '.classedit .deleteClass', function () {
        $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyMinBox"> <div class="popAddMoneyTop"> <span class="lf">请输入密码</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyMinBottom"> <div style="margin: 100px auto 10px"> <input value="" class="inputbox1min" type="text" maxlength="30"/> </div> <div class="minBtn"> <button class="refusemin rt" onclick="delThis()">取消</button> <button class="makeSuremin rt" onclick="makeSuremin()">确认</button> </div> </div> </div> </div> ')
        var popscrollwidth = $(window).width();
        var popscrollheight = $(window).height();
        console.log(popscrollwidth, popscrollheight);
        $(".popAddMoneyMinBox").css('left', (popscrollwidth / 2 - 180) + "px").css('top', (popscrollheight / 2 - 96.5) + "px");
    });
    function makeSuremin() {
        _This = $(this);
        var pwd = $('.inputbox1min').val()
        layboxs("action/delete_class.html?id=" + classId + "&url=/js/xsgl/delclazz" + "&fun=delok3&pwd=" + pwd, "notitle");
    }
    function delok3() {
        popation("220", "y", "删除成功！");
        closemask();
        $('.popopowindow').remove()
        $.ajax({
            url: "/cszyylfw/js/xsgl/clazzlist",
            type: 'post',
            async: false,
            data: 'token=' + token + '&page_no=1&page_size=100',
            success: function (res) {
                if (res.code == 0) {
                    $('.menuLevel2 ul').html('');

                    for (var i = 0; i < res.data.items.length; i++) {
                        if (i == 0) {
                            classId = res.data.items[0].id;
                            $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                        } else {
                            $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                        }
                    }
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！')
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })

        $.ajax({
            url: "/cszyylfw/js/xsgl/studentlist",
            type: 'post',
            async: false,
            data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
            success: function (res) {
                if (res.code == 0) {
                    $('.indextable tbody').html('');
                    for (var i = 0; i < res.data.items.length; i++) {
                        $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                    }
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！')
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })

    }
//    归档
        $('.saveClass').click(function () {
            $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyMinBox"> <div class="popAddMoneyTop"> <span class="lf">请输入密码</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyMinBottom"> <div style="margin: 100px auto 10px"> <span>确认归档后，该班级信息将不再此位置展示，是否归档！</span> </div> <div class="minBtn"> <button class="refusemin rt"  onclick="delThis()">取消</button> <button class="makeSuremin rt"  onclick="makeSuresave()">确认</button> </div> </div> </div> </div>')
            var popscrollwidth = $(window).width();
            var popscrollheight = $(window).height();
            console.log(popscrollwidth, popscrollheight);
            $(".popAddMoneyMinBox").css('left', (popscrollwidth / 2 - 180) + "px").css('top', (popscrollheight / 2 - 96.5) + "px");
        })
        function makeSuresave() {
            layboxs("action/saveClass.html?id=" + classId + "&url=/js/xsgl/archiveclazz" + "&fun=delok2", "notitle");
        }

        function delok2() {
            popation("220", "y", "归档成功！");
            closemask();
            $('.popopowindow').remove()
            $.ajax({
                url: "/cszyylfw/js/xsgl/clazzlist",
                type: 'post',
                async: false,
                data: 'token=' + token + '&page_no=1&page_size=100',
                success: function (res) {
                    if (res.code == 0) {
                        $('.menuLevel2 ul').html('');

                        for (var i = 0; i < res.data.items.length; i++) {
                            if (i == 0) {
                                classId = res.data.items[0].id;
                                $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                            } else {
                                $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                            }
                        }
                    } else if (res.code == 20) {
                        alert('登陆超时，请重新登录！')
                        setTimeout(function () {
                            location.href = 'js_index.html'
                        }, 1000)

                    } else {
                        alert(res.codeMsg)
                    }
                }
            })
            if (!classId) {
                $('.indextable tbody').html('');
            } else {

                $.ajax({
                    url: "/cszyylfw/js/xsgl/studentlist",
                    type: 'post',
                    async: false,
                    data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
                    success: function (res) {
                        if (res.code == 0) {
                            $('.indextable tbody').html('');
                            for (var i = 0; i < res.data.items.length; i++) {
                                $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                            }
                        } else if (res.code == 20) {
                            alert('登陆超时，请重新登录！')
                            setTimeout(function () {
                                location.href = 'js_index.html'
                            }, 1000)

                        } else {
                            alert(res.codeMsg)
                        }
                    }
                })


            }
        }

//    查询学生下面的项目


            //    查看
            $('tbody').on('click', 'td .lookat', function () {
//                window.open('index_xs.html?student_id=' + $(this).attr('id'))
                window.open('student_task.html?student_id=' + $(this).attr('id'))
            })
//    编辑
            $('tbody').on('click', '.colortd span:nth-child(1)', function () {
                    var id=$(this).attr('id');
                var numE=$(this).parent().parent().children().eq(0).html()
                var nameE=$(this).parent().parent().children().eq(1).html()
                var pwdE=$(this).parent().parent().children().eq(2).html()
                $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyBox"> <div class="popAddMoneyTop"> <span class="lf">新增学生</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyBottom"> <div style="margin: 100px auto 10px"> <span>学号</span><input value="'+numE+'" class="studentNum"  type="text" maxlength="30"/> </div> <div style="margin: 0 auto 10px"> <span>姓名</span><input value="'+nameE+'" class="studentName" type="text" maxlength="30"/> </div> <div style="margin: 0 auto 86px"> <span>密码</span><input value="'+pwdE+'" class="studentPwd" type="text" maxlength="30"/> </div> <button onclick="addStudents()" id="'+id+'"  class="popAddMoneyBoxBtn">保存</button> </div> </div> </div>')
                var popscrollwidth = $(window).width();
                var popscrollheight = $(window).height();
                console.log(popscrollwidth, popscrollheight);
                $(".popAddMoneyBox").css('left', (popscrollwidth / 2 - 335) + "px").css('top', (popscrollheight / 2 - 220) + "px");
//                window.open('student_task.html?student_id=' + $(this).attr('id'))
            })

    function addStudents() {
        var realname = $('.studentName').val();
        var student_no = $('.studentNum').val();
        var pwd = $('.studentPwd').val();
        var id=$('.popAddMoneyBoxBtn').attr('id');
//        var clazz_id = classId;
        $.ajax({
            url: "/cszyylfw/js/xsgl/alterstudent",
            type: 'post',
            async: false,
            data: 'token=' + token + "&realname=" + realname + "&student_no=" + student_no + "&pwd=" + pwd + "&id=" + id,
            success: function (res) {
                if (res.code == 0) {
                    $('.popopowindow').remove();
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/studentlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.indextable tbody').html('');
                                for (var i = 0; i < res.data.items.length; i++) {
                                    $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                                }
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！');
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！');
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })
    }



            //    删除
            $('tbody').on('click', '.colortd span:nth-child(2)', function () {
                var id = $(this).attr('id')
//        location.href='student_task.html?student_id='+$(this).attr('id')
                $.ajax({
                    url: "/cszyylfw/js/xsgl/xmcountofstudent",
                    type: 'post',
                    async: false,
                    data: 'token=' + token + "&id=" + id ,
                    success: function (res) {
                        if (res.code == 0) {
                            console.log(res.data.count)
                            layboxs("action/delete_xs_xiangmu.html?id=" + id + "&url=/js/xsgl/delstudent&count=" + res.data.count + "&fun=delok4", "notitle");
                        } else if (res.code == 20) {
                            alert('登陆超时，请重新登录！');
                            setTimeout(function () {
                                location.href = 'js_index.html'
                            }, 1000)

                        } else {
                            alert(res.codeMsg)
                        }
                    }
                })
            })
            function delok4() {
                popation("220", "y", "删除成功！");
                closemask();
                $('.popopowindow').remove()
                $.ajax({
                    url: "/cszyylfw/js/xsgl/clazzlist",
                    type: 'post',
                    async: false,
                    data: 'token=' + token + '&page_no=1&page_size=100',
                    success: function (res) {
                        if (res.code == 0) {
                            $('.menuLevel2 ul').html('');

                            for (var i = 0; i < res.data.items.length; i++) {
                                if (i == 0) {
                                    classId = res.data.items[0].id;
                                    $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                                } else {
                                    $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                                }
                            }
                        } else if (res.code == 20) {
                            alert('登陆超时，请重新登录！')
                            setTimeout(function () {
                                location.href = 'js_index.html'
                            }, 1000)

                        } else {
                            alert(res.codeMsg)
                        }
                    }
                })

                $.ajax({
                    url: "/cszyylfw/js/xsgl/studentlist",
                    type: 'post',
                    async: false,
                    data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
                    success: function (res) {
                        if (res.code == 0) {
                            $('.indextable tbody').html('');
                            for (var i = 0; i < res.data.items.length; i++) {
                                $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                            }
                        } else if (res.code == 20) {
                            alert('登陆超时，请重新登录！')
                            setTimeout(function () {
                                location.href = 'js_index.html'
                            }, 1000)

                        } else {
                            alert(res.codeMsg)
                        }
                    }
                })
            }



//    导入学生
    $('.linkStudent').click(function(){
        $('.file').click()

    })

$('.file').change(function(){
    var fd = new FormData(document.getElementById('uoloadxslx'));
    $.ajax({
        url:'/cszyylfw/js/xsgl/importxs?clazz_id='+classId+"&token="+token,
        type:'POST',
        data: fd,
//        data:"file="+fd+"&clazz_Id="+classId,
        async: false,
        cache: false,
        contentType: false,
        processData: false,

        success:function(res){
            if(res.code==0){
                error('表格里重复数据有  '+res.data.repetStudentNos.length+'  条，已存在数据  '+res.data.existedStudentNos.length+'  条，成功上传数据  '+res.data.successCount+'  条')
                setTimeout(function(){
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/studentlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + "&clazz_id=" + classId + '&page_no='+pageNo+'&page_size=50',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.indextable tbody').html('');
                                for (var i = 0; i < res.data.items.length; i++) {
                                    $('tbody').append('<tr> <td>' + res.data.items[i].studentNo + '</td> <td>' + res.data.items[i].realname + '</td> <td>' + res.data.items[i].pwd + '</td> <td><span  class="lookat" id="' + res.data.items[i].id + '">查看</span></td> <td class="colortd"><span id="' + res.data.items[i].id + '">编辑</span><span id="' + res.data.items[i].id + '">删除</span></td> </tr>')
                                }
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！')
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                },1000)
            }else if (res.code == 20) {
                alert('登陆超时，请重新登录！')
                setTimeout(function () {
                    location.href = 'js_index.html'
                }, 1000)

            } else {
                alert(res.codeMsg)
            }
        }
    })
})

    $('.modifyClass').click(function () {
        $('body').append('<div class="popopowindow"> <div class="popBackground"></div> <div class="popAddMoneyBox"> <div class="popAddMoneyTop"> <span class="lf">修改班级</span> <span class="deleteIcon rt" onclick="delThis()"></span> </div> <div class="popAddMoneyBottom"> <div style="margin: 150px auto 130px"> <span>班级名称</span><input value="" class="inputbox1" type="text" maxlength="30"/> </div> <button onclick="editClass()"  class="popAddMoneyBoxBtn">保存</button> </div> </div> </div>')
        var popscrollwidth = $(window).width();
        var popscrollheight = $(window).height();
        console.log(popscrollwidth, popscrollheight);
        $(".popAddMoneyBox").css('left', (popscrollwidth / 2 - 335) + "px").css('top', (popscrollheight / 2 - 220) + "px");
    })
    function editClass(){
        var classNameModify=$('.inputbox1').val()
        $.ajax({
            url: "/cszyylfw/js/xsgl/alterclazz",
            type: 'post',
            async: false,
            data: 'token=' + token + "&id=" + classId + '&cn='+classNameModify,
            success: function (res) {
                if (res.code == 0) {
                    $('.popopowindow').remove()
                    $.ajax({
                        url: "/cszyylfw/js/xsgl/clazzlist",
                        type: 'post',
                        async: false,
                        data: 'token=' + token + '&page_no=1&page_size=100',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.menuLevel2 ul').html('');

                                for (var i = 0; i < res.data.items.length; i++) {
                                    if(res.data.items[i].id==classId){
                                        $('.classroom span:nth-child(2)').html(res.data.items[i].name)
                                        reloadwidth()
//                                    if (i == 0) {
//                                        classId = res.data.items[0].id;
                                        $('.menuLevel2 ul').append('<li class="level2 btnone" style="background: #b1c54c;color: #fff" id="' + res.data.items[i].id + '"><span  style="background:url(images/icon44.png)"></span><span>' + res.data.items[i].name + '</span></li>')
                                    } else {
                                        $('.menuLevel2 ul').append('<li class="level2" id="' + res.data.items[i].id + '"><span></span><span>' + res.data.items[i].name + '</span></li>')
                                    }
                                }
                                studentList()
                            } else if (res.code == 20) {
                                alert('登陆超时，请重新登录！');
                                setTimeout(function () {
                                    location.href = 'js_index.html'
                                }, 1000)

                            } else {
                                alert(res.codeMsg)
                            }
                        }
                    })
                } else if (res.code == 20) {
                    alert('登陆超时，请重新登录！');
                    setTimeout(function () {
                        location.href = 'js_index.html'
                    }, 1000)

                } else {
                    alert(res.codeMsg)
                }
            }
        })
    }
    reloadwidth()
</script>
</body>
</html>